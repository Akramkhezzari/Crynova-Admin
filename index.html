<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ - Crynova</title>
  <style>
    /* ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù„Ù‡Ø§ØªÙ ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    }

    :root {
      --primary: #007AFF;
      --secondary: #5856D6;
      --success: #34C759;
      --danger: #FF3B30;
      --warning: #FF9500;
      --dark: #1C1C1E;
      --light: #F2F2F7;
      --border: #C7C7CC;
      --card-bg: #FFFFFF;
      --background: #F2F2F7;
    }

    body {
      background: var(--background);
      color: var(--dark);
      font-size: 16px;
      line-height: 1.5;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 0;
      margin: 0;
    }

    /* ========== ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„ÙƒØ§Ù…Ù„ ========== */
    .mobile-container {
      width: 100%;
      min-height: 100vh;
      max-width: 100%;
      overflow-x: hidden;
      position: relative;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ù‡Ø§ØªÙ - Ù…Ø®ÙÙŠ */
    .status-bar {
      display: none;
    }

    /* Ù‡ÙŠØ¯Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    .app-header {
      background: var(--primary);
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .back-btn {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app-logo {
      width: 36px;
      height: 36px;
      background: white;
      color: var(--primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
    }

    .app-title {
      font-size: 18px;
      font-weight: 700;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logout-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    .app-content {
      padding: 16px;
      padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
    }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„Ù‡Ø§ØªÙ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.05);
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-bottom: 12px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 13px;
      color: #8E8E93;
    }

    /* Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    .content-section {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.05);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
    }

    .section-badge {
      background: var(--primary);
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„Ù‡Ø§ØªÙ */
    .users-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .user-card {
      background: var(--light);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }

    .user-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .user-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 20px;
    }

    .user-details {
      flex: 1;
    }

    .user-name {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 4px;
    }

    .user-id {
      font-size: 13px;
      color: #8E8E93;
    }

    .user-status {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
    }

    .status-dot.new {
      background: var(--warning);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .user-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
    }

    .stat-item-label {
      font-size: 12px;
      color: #8E8E93;
      margin-bottom: 4px;
    }

    .stat-item-value {
      font-weight: 600;
      font-size: 14px;
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„Ù„Ù‡Ø§ØªÙ */
    .action-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
    }

    .action-btn {
      padding: 14px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .action-btn:active {
      transform: scale(0.98);
    }

    .action-btn.full-width {
      grid-column: 1 / -1;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-secondary {
      background: var(--light);
      color: var(--dark);
      border: 1px solid var(--border);
    }

    /* Ø²Ø± Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ¹ - ØªØµÙ…ÙŠÙ… Ù…Ù…ÙŠØ² Ù„Ù„Ù‡Ø§ØªÙ */
    .quick-gift-btn {
      background: linear-gradient(135deg, #34C759, #30D158);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 16px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(52, 199, 89, 0.3);
      transition: all 0.2s;
      width: 100%;
    }

    .quick-gift-btn:active {
      transform: scale(0.98);
      box-shadow: 0 2px 8px rgba(52, 199, 89, 0.3);
    }

    .quick-gift-btn.loading {
      opacity: 0.8;
      cursor: wait;
    }

    /* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù‡Ø¯ÙŠØ© Ù„Ù„Ù‡Ø§ØªÙ */
    .gift-form {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.05);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 16px;
    }

    .form-select {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--light);
      font-size: 16px;
      -webkit-appearance: none;
      appearance: none;
    }

    .form-input {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--light);
      font-size: 16px;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .amount-preview {
      background: var(--light);
      border-radius: 12px;
      padding: 12px;
      margin-top: 8px;
      font-size: 14px;
      color: #8E8E93;
    }

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ù„Ù‡Ø§ØªÙ */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border-top: 1px solid var(--border);
      display: flex;
      padding: 12px 16px;
      gap: 8px;
      z-index: 1000;
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      padding: 12px 0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-item:active {
      background: var(--light);
    }

    .nav-item.active {
      color: var(--primary);
    }

    .nav-icon {
      font-size: 20px;
    }

    .nav-label {
      font-size: 12px;
      font-weight: 600;
    }

    /* ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù‡Ø§ØªÙ */
    .login-container {
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 32px 24px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .login-logo {
      text-align: center;
      margin-bottom: 32px;
    }

    .login-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 40px;
      margin: 0 auto 20px;
    }

    .login-title {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 8px;
    }

    .login-subtitle {
      color: #8E8E93;
      text-align: center;
      font-size: 14px;
      margin-bottom: 32px;
    }

    .login-btn {
      width: 100%;
      padding: 18px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 14px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .login-btn:active {
      transform: scale(0.98);
    }

    /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù‡Ø§ØªÙ */
    .toast {
      position: fixed;
      top: 20px;
      left: 20px;
      right: 20px;
      background: var(--dark);
      color: white;
      padding: 16px;
      border-radius: 14px;
      z-index: 9999;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .toast.success {
      background: var(--success);
    }

    .toast.error {
      background: var(--danger);
    }

    .toast.warning {
      background: var(--warning);
    }

    /* Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ù‡Ø§ØªÙ */
    .confirm-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 9999;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .confirm-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: scaleIn 0.3s ease;
    }

    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .confirm-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .confirm-message {
      color: #8E8E93;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .confirm-buttons {
      display: flex;
      gap: 12px;
    }

    .confirm-btn {
      flex: 1;
      padding: 16px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
    }

    .confirm-btn.cancel {
      background: var(--light);
      color: var(--dark);
    }

    .confirm-btn.confirm {
      background: var(--primary);
      color: white;
    }

    /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ù‡Ø§ØªÙ */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--card-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9998;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--light);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--dark);
      font-weight: 600;
    }

    /* Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #8E8E93;
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-text {
      font-size: 16px;
      margin-bottom: 8px;
    }

    .empty-subtext {
      font-size: 14px;
      opacity: 0.7;
    }

    /* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± */
    .desktop-only {
      display: none;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
    @media (min-width: 768px) {
      .mobile-container {
        max-width: 768px;
        margin: 0 auto;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
        min-height: 100vh;
      }
    }

    /* Ø¯Ø¹Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø¸Ù„Ù…Ø© */
    @media (prefers-color-scheme: dark) {
      :root {
        --dark: #FFFFFF;
        --light: #1C1C1E;
        --border: #38383A;
        --card-bg: #2C2C2E;
        --background: #000000;
      }
      
      .app-header {
        background: var(--card-bg);
        border-bottom: 1px solid var(--border);
      }
      
      .stat-card, .content-section, .user-card, .gift-form {
        background: var(--card-bg);
        border-color: var(--border);
      }
      
      .bottom-nav {
        background: var(--card-bg);
        border-color: var(--border);
      }
      
      .login-card {
        background: var(--card-bg);
      }
    }
  </style>
</head>
<body>
  <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginPage" class="login-container">
    <div class="login-card">
      <div class="login-logo">
        <div class="login-icon">ğŸ”</div>
        <h1 class="login-title">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h1>
        <p class="login-subtitle">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Crynova Wallet</p>
      </div>
      
      <div class="form-group">
        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
        <input type="text" id="adminUsername" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" value="admin">
      </div>
      
      <div class="form-group">
        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="adminPassword" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="admin123">
      </div>
      
      <button class="login-btn" onclick="adminLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      
      <div style="text-align: center; margin-top: 24px; font-size: 12px; color: #8E8E93;">
        Â© 2025 Crynova - Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø·
      </div>
    </div>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="adminPanel" class="mobile-container" style="display: none;">
    <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
    
    <!-- Ù‡ÙŠØ¯Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <div class="app-header">
      <div class="header-left">
        <button class="back-btn" id="backBtn" style="display: none;">â†</button>
        <div class="app-logo">C</div>
        <div>
          <div class="app-title" id="pageTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
          <div style="font-size: 12px; opacity: 0.8;" id="pageSubtitle">Crynova Admin</div>
        </div>
      </div>
      
      <div class="header-right">
        <button class="logout-btn" onclick="adminLogout()">Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>
    
    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="app-content" id="appContent">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>
    
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠØ© -->
    <div class="bottom-nav">
      <button class="nav-item active" data-page="dashboard" onclick="loadPage('dashboard')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </button>
      <button class="nav-item" data-page="settings" onclick="loadPage('settings')">
        <span class="nav-icon">âš™ï¸</span>
        <span class="nav-label">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
      </button>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
  <div id="loadingScreen" class="loading-screen" style="display: none;">
    <div class="loading-spinner"></div>
    <div class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ -->
  <div id="confirmModal" class="confirm-modal" style="display: none;">
    <div class="confirm-card">
      <h3 class="confirm-title" id="confirmTitle">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</h3>
      <p class="confirm-message" id="confirmMessage">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†ÙÙŠØ° Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ØŸ</p>
      <div class="confirm-buttons">
        <button class="confirm-btn cancel" onclick="hideConfirm()">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="confirm-btn confirm" onclick="confirmAction()">ØªØ£ÙƒÙŠØ¯</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  
  <script>
    // ========== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ==========
    const firebaseConfig = {
      apiKey: "AIzaSyBX8v0qIVjG-Z46fVDeEUDKcPxa_FQF9Qc",
      authDomain: "bnak-belaiba.firebaseapp.com",
      projectId: "bnak-belaiba",
      storageBucket: "bnak-belaiba.firebasestorage.app",
      messagingSenderId: "286736432059",
      appId: "1:286736432059:web:ec1ed4292850f00008229e"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    let db;
    try {
      const app = firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      console.log('âœ… Firebase initialized successfully');
    } catch (error) {
      console.error('âŒ Firebase initialization error:', error);
    }

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
    const coinInfo = {
      'USDT': { name: 'Tether', icon: 'ï¼„', color: '#26a17b', value: 1.0 },
      'CNC': { name: 'Crynova Coin', icon: 'C', color: '#007AFF', value: 0.50 },
      'BTC': { name: 'Bitcoin', icon: 'â‚¿', color: '#f7931a', value: 68423.50 },
      'ETH': { name: 'Ethereum', icon: 'Î', color: '#627eea', value: 3812.75 }
    };

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let currentAdmin = null;
    let allUsers = [];
    let newUsers = [];
    let pendingConfirm = null;
    let currentPage = 'dashboard';
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ - Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ù‡Ø¯ÙŠØ©
    let giftHistory = JSON.parse(localStorage.getItem('crynova_gift_history') || '{}');

    // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
    document.addEventListener('DOMContentLoaded', function() {
      // Ø¥Ø²Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª (Ù„Ø£Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ù…Ø®ÙÙŠ)
      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
      document.getElementById('adminPassword')?.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') adminLogin();
      });
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      loadSettings();
    });

    // ========== Ø¯ÙˆØ§Ù„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¯Ø§Ù„Ø© updateTime Ù„Ø£Ù† Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø®ÙÙŠ

    function showLoading(show) {
      document.getElementById('loadingScreen').style.display = show ? 'flex' : 'none';
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function showConfirm(title, message, callback) {
      pendingConfirm = callback;
      document.getElementById('confirmTitle').textContent = title;
      document.getElementById('confirmMessage').textContent = message;
      document.getElementById('confirmModal').style.display = 'flex';
    }

    function hideConfirm() {
      document.getElementById('confirmModal').style.display = 'none';
      pendingConfirm = null;
    }

    function confirmAction() {
      if (pendingConfirm) {
        pendingConfirm();
      }
      hideConfirm();
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙØ­Ø§Øª ==========
    function loadPage(page) {
      currentPage = page;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ©
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.dataset.page === page) {
          item.classList.add('active');
        }
      });
      
      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
      const backBtn = document.getElementById('backBtn');
      backBtn.style.display = page === 'dashboard' ? 'none' : 'flex';
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
      loadPageContent(page);
    }

    async function loadPageContent(page) {
      const content = document.getElementById('appContent');
      
      switch(page) {
        case 'dashboard':
          await loadDashboard();
          break;
        case 'settings':
          await loadSettingsPage();
          break;
      }
    }

    function updatePageTitle(title, subtitle = '') {
      document.getElementById('pageTitle').textContent = title;
      document.getElementById('pageSubtitle').textContent = subtitle;
    }

    // ========== Ø¯ÙˆØ§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ==========
    async function adminLogin() {
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;
      
      if (!username || !password) {
        showToast('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        return;
      }
      
      showLoading(true);
      
      // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ£Ø®ÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ©
      setTimeout(async () => {
        try {
          // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†
          const adminUsers = [
            { username: "admin", password: "admin123", name: "Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ" },
            { username: "crynova", password: "crynova2025", name: "Ù…Ø´Ø±Ù Crynova" }
          ];
          
          const admin = adminUsers.find(u => u.username === username && u.password === password);
          
          if (admin) {
            currentAdmin = admin;
            showToast(`âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ ${admin.name}`);
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            await loadAppData();
            
          } else {
            showToast('âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
          }
        } catch (error) {
          console.error('âŒ Login error:', error);
          showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
        } finally {
          showLoading(false);
        }
      }, 1000);
    }

    function adminLogout() {
      showConfirm('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ', () => {
        currentAdmin = null;
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('loginPage').style.display = 'flex';
        showToast('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
      });
    }

    // ========== Ø¯ÙˆØ§Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
    async function loadAppData() {
      showLoading(true);
      try {
        await loadUsersData();
        loadDashboard();
      } catch (error) {
        console.error('âŒ Error loading app data:', error);
        showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
      } finally {
        showLoading(false);
      }
    }

    async function loadUsersData() {
      try {
        if (!db) {
          // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ØªØ·ÙˆÙŠØ±
          allUsers = generateMockUsers(15);
          updateUsersLists();
          return;
        }
        
        const walletsSnapshot = await db.collection('wallets').get();
        const users = [];
        
        walletsSnapshot.forEach(doc => {
          const walletData = doc.data();
          const userId = walletData.userId;
          
          // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
          let totalBalance = 0;
          if (walletData.balances) {
            Object.entries(walletData.balances).forEach(([symbol, amount]) => {
              const coinValue = coinInfo[symbol]?.value || 0;
              totalBalance += amount * coinValue;
            });
          }
          
          // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ø£Ù†Ø´Ø¦ Ø®Ù„Ø§Ù„ 3 Ø£ÙŠØ§Ù… ÙˆÙ„Ù… ÙŠØªÙ„Ù‚ Ù‡Ø¯ÙŠØ©
          const createdAt = walletData.createdAt ? walletData.createdAt.toDate() : new Date();
          const isNew = (new Date() - createdAt) < (3 * 24 * 60 * 60 * 1000) && !walletData.hasReceivedGift;
          
          users.push({
            id: userId,
            name: walletData.userName || `Ù…Ø³ØªØ®Ø¯Ù… ${userId.substring(0, 6)}`,
            username: walletData.username || 'ØºÙŠØ± Ù…ØªÙˆÙØ±',
            createdAt: createdAt,
            totalBalance: totalBalance,
            balances: walletData.balances || {},
            isNew: isNew,
            hasReceivedGift: walletData.hasReceivedGift || false,
            giftCount: walletData.giftCount || 0,
            lastGiftDate: walletData.lastGiftDate ? walletData.lastGiftDate.toDate() : null
          });
        });
        
        allUsers = users.sort((a, b) => b.createdAt - a.createdAt);
        updateUsersLists();
        
      } catch (error) {
        console.error('âŒ Error loading users:', error);
        throw error;
      }
    }

    function updateUsersLists() {
      // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø¬Ø¯Ø¯ (Ù„Ù… ÙŠØªÙ„Ù‚ÙˆØ§ Ù‡Ø¯ÙŠØ©)
      newUsers = allUsers.filter(user => user.isNew && !user.hasReceivedGift);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù†Ø´Ø·Ø©
      if (currentPage === 'dashboard') {
        loadPageContent(currentPage);
      }
    }

    // ========== ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ==========
    async function loadDashboard() {
      updatePageTitle('Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…');
      
      const totalUsers = allUsers.length;
      const newUsersCount = newUsers.length;
      const giftedUsers = allUsers.filter(u => u.hasReceivedGift).length;
      const totalGifts = allUsers.reduce((sum, user) => sum + (user.giftCount || 0), 0);
      const totalBalance = allUsers.reduce((sum, user) => sum + user.totalBalance, 0);
      
      const content = `
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon" style="background: rgba(0, 122, 255, 0.1); color: var(--primary);">ğŸ‘¥</div>
            <div class="stat-value">${totalUsers}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon" style="background: rgba(52, 199, 89, 0.1); color: var(--success);">ğŸ’°</div>
            <div class="stat-value">$${totalBalance.toFixed(0)}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±ØµØ¯Ø©</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon" style="background: rgba(255, 149, 0, 0.1); color: var(--warning);">ğŸ†•</div>
            <div class="stat-value">${newUsersCount}</div>
            <div class="stat-label">Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon" style="background: rgba(88, 86, 214, 0.1); color: var(--secondary);">ğŸ</div>
            <div class="stat-value">${giftedUsers}</div>
            <div class="stat-label">Ù…Ø³ØªÙ„Ù…ÙŠÙ† Ù‡Ø¯Ø§ÙŠØ§</div>
          </div>
        </div>
        
        <div class="content-section">
          <div class="section-header">
            <h3 class="section-title">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯</h3>
            <span class="section-badge">${newUsersCount}</span>
          </div>
          
          ${newUsers.length > 0 ? `
            <div class="users-list">
              ${newUsers.slice(0, 3).map(user => `
                <div class="user-card" data-user-id="${user.id}">
                  <div class="user-header">
                    <div class="user-info">
                      <div class="user-avatar">${user.name.charAt(0)}</div>
                      <div class="user-details">
                        <div class="user-name">${user.name}</div>
                        <div class="user-id">${user.username}</div>
                      </div>
                    </div>
                    <div class="user-status">
                      <div class="status-dot new"></div>
                      <span style="font-size: 12px;">Ø¬Ø¯ÙŠØ¯</span>
                    </div>
                  </div>
                  
                  <div class="user-stats">
                    <div class="stat-item">
                      <span class="stat-item-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span>
                      <span class="stat-item-value">${formatDateShort(user.createdAt)}</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-item-label">Ø§Ù„Ø±ØµÙŠØ¯</span>
                      <span class="stat-item-value">$${user.totalBalance.toFixed(2)}</span>
                    </div>
                  </div>
                  
                  <button class="quick-gift-btn" onclick="sendQuickGift('${user.id}', 'USDT', 100)">
                    <span>ğŸ</span>
                    Ø¥Ø±Ø³Ø§Ù„ 100 USDT
                  </button>
                </div>
              `).join('')}
            </div>
          ` : `
            <div class="empty-state">
              <div class="empty-icon">ğŸ‰</div>
              <div class="empty-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯</div>
              <div class="empty-subtext">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØªÙ„Ù‚ÙˆØ§ Ù‡Ø¯Ø§ÙŠØ§Ù‡Ù… Ø¨Ø§Ù„ÙØ¹Ù„</div>
            </div>
          `}
        </div>
        
        <div class="content-section">
          <div class="section-header">
            <h3 class="section-title">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
          </div>
          
          <div class="action-buttons">
            <button class="action-btn btn-primary" onclick="sendGiftToAllNewUsers()">
              <span>ğŸ</span>
              Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹
            </button>
            <button class="action-btn btn-success" onclick="refreshData()">
              <span>ğŸ”„</span>
              ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('appContent').innerHTML = content;
    }

    // ========== ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ==========
    async function loadSettingsPage() {
      updatePageTitle('Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'ØªØ®ØµÙŠØµ Ø§Ù„Ù†Ø¸Ø§Ù…');
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      const settings = JSON.parse(localStorage.getItem('crynova_settings') || '{}');
      
      const content = `
        <div class="content-section">
          <div class="section-header">
            <h3 class="section-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
          </div>
          
          <div class="gift-form">
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (USDT)</label>
              <input type="number" class="form-input" id="defaultGiftAmount" value="${settings.defaultGiftAmount || 100}" min="1">
            </div>
            
            <div class="form-group">
              <label class="form-label">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</label>
              <textarea class="form-input" id="defaultGiftMessage" rows="3">${settings.defaultGiftMessage || 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø­ÙØ¸Ø© Crynova Ø§Ù„Ø±Ù‚Ù…ÙŠØ©! Ù„Ù‚Ø¯ Ù‚Ù…Ù†Ø§ Ø¨Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯ÙŠØ© ØªØ±Ø­ÙŠØ¨ÙŠØ© Ù„Ù…Ø­ÙØ¸ØªÙƒ. Ø§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹Ù†Ø§.'}</textarea>
            </div>
            
            <div class="form-group">
              <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ù„Ø§Ø¹ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "Ø¬Ø¯ÙŠØ¯"</label>
              <select class="form-select" id="newUserDays">
                <option value="1" ${(settings.newUserDays || 3) === 1 ? 'selected' : ''}>ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</option>
                <option value="3" ${(settings.newUserDays || 3) === 3 ? 'selected' : ''}>3 Ø£ÙŠØ§Ù…</option>
                <option value="7" ${(settings.newUserDays || 3) === 7 ? 'selected' : ''}>Ø£Ø³Ø¨ÙˆØ¹</option>
                <option value="30" ${(settings.newUserDays || 3) === 30 ? 'selected' : ''}>Ø´Ù‡Ø±</option>
              </select>
            </div>
            
            <button class="action-btn btn-success full-width" onclick="saveSettings()">
              <span>ğŸ’¾</span>
              Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('appContent').innerHTML = content;
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ==========
    async function sendQuickGift(userId, currency, amount) {
      const user = allUsers.find(u => u.id === userId);
      if (!user) {
        showToast('âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙ„Ù‚ÙŠ Ø§Ù„Ù‡Ø¯ÙŠØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹
      if (user.hasReceivedGift) {
        showToast('âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªÙ„Ù‚Ù‰ Ù‡Ø¯ÙŠØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'warning');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø³Ø¬Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ù„ÙŠ
      if (giftHistory[userId]) {
        showToast('âš ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø¯ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'warning');
        return;
      }
      
      showConfirm('Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø¯ÙŠØ©', 
        `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ ${amount} ${currency} Ø¥Ù„Ù‰ ${user.name}ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù†Ù‡Ø§Ø¦ÙŠ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`,
        async () => {
          await processGift(user, currency, amount, 'Ù‡Ø¯ÙŠØ© Ø³Ø±ÙŠØ¹Ø© Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„');
        }
      );
    }

    async function sendGiftToAllNewUsers() {
      if (newUsers.length === 0) {
        showToast('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ù„Ù‡Ù…', 'warning');
        return;
      }
      
      showConfirm('Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø¯Ø§ÙŠØ§ Ù„Ù„Ø¬Ù…ÙŠØ¹',
        `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ 100 USDT Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ (${newUsers.length} Ù…Ø³ØªØ®Ø¯Ù…)ØŸ\n\nØ³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø¨Ø´ÙƒÙ„ ÙØ±Ø¯ÙŠ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.`,
        async () => {
          showLoading(true);
          let successCount = 0;
          let errorCount = 0;
          
          for (const user of newUsers) {
            try {
              // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙ„Ù‚ÙŠ Ø§Ù„Ù‡Ø¯ÙŠØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹
              if (!user.hasReceivedGift && !giftHistory[user.id]) {
                await processGift(user, 'USDT', 100, 'Ù‡Ø¯ÙŠØ© ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø¬Ù…Ø§Ø¹ÙŠØ©');
                successCount++;
                
                // ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ Ù‡Ø¯ÙŠØ©
                await new Promise(resolve => setTimeout(resolve, 300));
              }
            } catch (error) {
              console.error(`âŒ Error sending gift to ${user.name}:`, error);
              errorCount++;
            }
          }
          
          showLoading(false);
          
          if (successCount > 0) {
            showToast(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø¥Ù„Ù‰ ${successCount} Ù…Ø³ØªØ®Ø¯Ù…${errorCount > 0 ? `ØŒ ÙØ´Ù„ ${errorCount}` : ''}`);
            await refreshData();
          } else {
            showToast('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ù‡Ø¯Ø§ÙŠØ§', 'warning');
          }
        }
      );
    }

    async function processGift(user, currency, amount, message) {
      showLoading(true);
      
      try {
        // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ£Ø®ÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ©
        await new Promise(resolve => setTimeout(resolve, 800));
        
        if (db) {
          // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          const userRef = db.collection('wallets').doc(user.id);
          const userDoc = await userRef.get();
          
          if (userDoc.exists) {
            const userData = userDoc.data();
            const currentBalance = userData.balances?.[currency] || 0;
            const newBalance = currentBalance + amount;
            
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            await userRef.update({
              [`balances.${currency}`]: newBalance,
              hasReceivedGift: true,
              giftCount: (userData.giftCount || 0) + 1,
              lastGiftDate: new Date(),
              updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
            await db.collection('transactions').add({
              userId: user.id,
              userName: user.name,
              type: 'gift',
              amount: amount,
              currency: currency,
              message: message || 'Ù‡Ø¯ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„',
              adminId: currentAdmin?.username || 'system',
              status: 'completed',
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
          }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        user.balances[currency] = (user.balances[currency] || 0) + amount;
        user.hasReceivedGift = true;
        user.giftCount = (user.giftCount || 0) + 1;
        user.lastGiftDate = new Date();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        user.totalBalance += amount * (coinInfo[currency]?.value || 0);
        
        // Ø­ÙØ¸ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ù„ÙŠ
        giftHistory[user.id] = {
          date: new Date().toISOString(),
          amount: amount,
          currency: currency
        };
        localStorage.setItem('crynova_gift_history', JSON.stringify(giftHistory));
        
        showToast(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${amount} ${currency} Ø¥Ù„Ù‰ ${user.name}`);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        updateUsersLists();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        loadPageContent(currentPage);
        
      } catch (error) {
        console.error('âŒ Error processing gift:', error);
        showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‡Ø¯ÙŠØ©', 'error');
      } finally {
        showLoading(false);
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
    function formatDateShort(date) {
      const d = new Date(date);
      const now = new Date();
      const diff = now - d;
      
      if (diff < 24 * 60 * 60 * 1000) {
        // Ø£Ù‚Ù„ Ù…Ù† ÙŠÙˆÙ…
        return 'Ø§Ù„ÙŠÙˆÙ…';
      } else if (diff < 48 * 60 * 60 * 1000) {
        // Ø£Ù‚Ù„ Ù…Ù† ÙŠÙˆÙ…ÙŠÙ†
        return 'Ø£Ù…Ø³';
      } else if (diff < 7 * 24 * 60 * 60 * 1000) {
        // Ø£Ù‚Ù„ Ù…Ù† Ø£Ø³Ø¨ÙˆØ¹
        const days = Math.floor(diff / (24 * 60 * 60 * 1000));
        return `Ù…Ù†Ø° ${days} ÙŠÙˆÙ…`;
      } else {
        // Ø£ÙƒØ«Ø± Ù…Ù† Ø£Ø³Ø¨ÙˆØ¹
        const day = d.getDate().toString().padStart(2, '0');
        const month = (d.getMonth() + 1).toString().padStart(2, '0');
        return `${day}/${month}`;
      }
    }

    function refreshData() {
      showLoading(true);
      loadAppData().then(() => {
        showLoading(false);
        showToast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      });
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ==========
    function loadSettings() {
      const saved = localStorage.getItem('crynova_settings');
      if (saved) {
        return JSON.parse(saved);
      }
      return {};
    }

    function saveSettings() {
      const settings = {
        defaultGiftAmount: parseInt(document.getElementById('defaultGiftAmount').value) || 100,
        defaultGiftMessage: document.getElementById('defaultGiftMessage').value,
        newUserDays: parseInt(document.getElementById('newUserDays').value) || 3
      };
      
      localStorage.setItem('crynova_settings', JSON.stringify(settings));
      showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
    }

    // ========== Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ØªØ·ÙˆÙŠØ± ==========
    function generateMockUsers(count) {
      const users = [];
      const firstNames = ['Ø£Ø­Ù…Ø¯', 'Ù…Ø­Ù…Ø¯', 'Ø¹Ù„ÙŠ', 'ÙØ§Ø·Ù…Ø©', 'Ø³Ø§Ø±Ø©', 'Ø®Ø§Ù„Ø¯', 'Ù…Ø±ÙŠÙ…', 'ÙŠÙˆØ³Ù', 'Ù†ÙˆØ±', 'Ø¹Ù…Ø±'];
      const lastNames = ['Ø§Ù„Ø²ÙŠØ¯ÙŠ', 'Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', 'Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', 'Ø§Ù„Ø´Ù‡Ø±ÙŠ', 'Ø§Ù„Ø¹Ù…Ø±ÙŠ', 'Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠ', 'Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ', 'Ø§Ù„Ù‚Ø±Ø´ÙŠ', 'Ø§Ù„Ø³Ø¨ÙŠØ¹ÙŠ', 'Ø§Ù„ØºØ±Ø¨ÙŠ'];
      
      for (let i = 1; i <= count; i++) {
        const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
        const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
        const name = `${firstName} ${lastName}`;
        const username = `user${1000 + i}`;
        const userId = `user${1000 + i}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        
        // ØªØ§Ø±ÙŠØ® Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø®Ù„Ø§Ù„ Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…
        const createdAt = new Date();
        createdAt.setDate(createdAt.getDate() - Math.floor(Math.random() * 7));
        
        // Ø£Ø±ØµØ¯Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        const balances = {};
        Object.keys(coinInfo).forEach(symbol => {
          if (Math.random() > 0.5) {
            balances[symbol] = parseFloat((Math.random() * 100).toFixed(4));
          }
        });
        
        // Ø±ØµÙŠØ¯ Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        let totalBalance = 0;
        Object.entries(balances).forEach(([symbol, amount]) => {
          const coinValue = coinInfo[symbol]?.value || 0;
          totalBalance += amount * coinValue;
        });
        
        // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (75% Ø¬Ø¯Ø¯ØŒ 25% ØªÙ„Ù‚ÙˆØ§ Ù‡Ø¯Ø§ÙŠØ§)
        const hasReceivedGift = Math.random() > 0.75;
        const isNew = !hasReceivedGift && (new Date() - createdAt) < (3 * 24 * 60 * 60 * 1000);
        
        users.push({
          id: userId,
          name: name,
          username: username,
          createdAt: createdAt,
          totalBalance: totalBalance,
          balances: balances,
          isNew: isNew,
          hasReceivedGift: hasReceivedGift,
          giftCount: hasReceivedGift ? Math.floor(Math.random() * 3) : 0,
          lastGiftDate: hasReceivedGift ? new Date(createdAt.getTime() + 1000 * 60 * 60 * 24) : null
        });
      }
      
      return users.sort((a, b) => b.createdAt - a.createdAt);
    }
  </script>
</body>
</html>
